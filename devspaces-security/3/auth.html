<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Authentication in Red Hat OpenShift Dev Spaces :: Securing Access to Red Hat OpenShift DevSpaces</title>
    <link rel="prev" href="auto-namespaces.html">
    <link rel="next" href="rbac.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../..">Securing Access to Red Hat OpenShift DevSpaces</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/devspaces-security/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="devspaces-security" data-version="3">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Securing Access to Red Hat OpenShift DevSpaces</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Home</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="auto-namespaces.html">Namespace Control</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="auth.html">Authentication</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="rbac.html">Access Control</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Securing Access to Red Hat OpenShift DevSpaces</span>
    <span class="version">3</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Securing Access to Red Hat OpenShift DevSpaces</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">3</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Securing Access to Red Hat OpenShift DevSpaces</a></li>
    <li><a href="auth.html">Authentication</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Authentication in Red Hat OpenShift Dev Spaces</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat OpenShift Dev Spaces runs on top of the OpenShift Container Platform, and relies on the underlying platform for many security related features. In previous hands-on labs, you used the <code>admin</code> user to install Dev Spaces as well as perform administrative tasks. You also used non-admin accounts <code>user1&#8230;&#8203;user5</code> to launch workspaces and test other features of the product (simulating a regular developer persona).</p>
</div>
<div class="paragraph">
<p>The <code>admin</code> and <code>userX</code> users are authenticated using the internal OpenShift OAuth server backed by credentials stored in an encrypted <code>HTPasswd</code> file. OpenShift supports a number of different <em>Identity Providers</em> like LDAP, GitHub, GitLab, and more. See <a href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.16/html-single/authentication_and_authorization/index#supported-identity-providers" target="_blank" rel="noopener">OpenShift Supported identity providers</a> for the supported list.</p>
</div>
<div class="paragraph">
<p>Configuring the OAuth server and identity providers for the base OpenShift Container Platform is outside the scope of this course. Consult the product documentation for <a href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.16/html-single/authentication_and_authorization/index" target="_blank" rel="noopener">OpenShift Authentication and authorization</a> for details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_credentials_passthrough_in_workspaces"><a class="anchor" href="#_configuring_credentials_passthrough_in_workspaces"></a>Configuring Credentials Passthrough in Workspaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the hands-on labs so far, you have logged in using accounts managed by the base OpenShift OAuth server. For GitHub repositories that are <strong>public</strong>, you can clone the repositories in the workspace. However, if you want to clone private repositories, or make changes inside the Dev Spaces IDE, and commit the changes back to GitHub, you need to manually setup GitHub tokens or keys and configure your <code>.gitconfig</code> file inside the workspace. You need to do this for every workspace you launch since workspaces are based on container images that are immutable.</p>
</div>
<div class="paragraph">
<p>Alternatively, for projects where you work with source code in GitHub, GitLab or equivalent source control, you can set up Dev Spaces to authenticate using the OAuth 2.0 protocol and passthrough the user credentials to the workspaces automatically.</p>
</div>
<div class="paragraph">
<p>When you launch a workspace, you will be prompted for your Git credentials. After you successfully log in, your credentials will be passed through to your IDE instance and you can now pull private repositories, as well as commit changes back to GitHub without any manual set up.</p>
</div>
<div class="paragraph">
<p>Dev Spaces supports a number of OAuth 2.0 providers like GitHub, GitLab, BitBucket and Azure DevOps. We will mostly focus on GitHub in this section.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Another alternative is to use GitHub/GitLab Personal Access Tokens (PAT), but this method also requires some manual effort and is less flexible than configuring OAuth for your Dev Spaces setup.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_configuring_github_oauth_2_0_authentication_for_workspaces"><a class="anchor" href="#_lab_configuring_github_oauth_2_0_authentication_for_workspaces"></a>Lab: Configuring GitHub OAuth 2.0 Authentication for Workspaces</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pre_requisites"><a class="anchor" href="#_pre_requisites"></a>Pre-requisites</h3>
<div class="ulist">
<ul>
<li>
<p>You must have set up the authentication using the <code>HTPasswd</code> provider as outlined in the <a href="https://redhatquickcourses.github.io/devspaces-admin/devspaces-admin/3/index.html#_configuring_openshift_users_and_authentication" target="_blank" rel="noopener">Configuring OpenShift Users and Authentication</a> in the second course of the learning path. Review the YAML configuration files from that section as a refresher.</p>
</li>
<li>
<p>You must have a GitHub account</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_steps"><a class="anchor" href="#_steps"></a>Steps</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To configure GitHub OAuth, you need to generate a client ID and client secret from the GitHub side. Log in to GitHub, and navigate to <a href="https://github.com/settings/applications/new" class="bare">https://github.com/settings/applications/new</a> to create a new GitHub OAuth App.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You need to create OAuth apps and <strong>NOT</strong> GitHub Apps!. Follow the steps and screenshots carefully.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>In the <code>New OAuth Application</code> page, enter the following :</p>
<div class="ulist">
<ul>
<li>
<p><strong>Application name</strong>: <code>devspaces-auth</code></p>
</li>
<li>
<p><strong>Homepage URL</strong>: <em>&lt;OpenShift Dev Spaces URL&gt;</em></p>
</li>
<li>
<p><strong>Authorization callback URL</strong>: <a href="https://&lt;openshift_dev_spaces_url&gt;/api/oauth/callback" class="bare">https://&lt;openshift_dev_spaces_url&gt;/api/oauth/callback</a></p>
<div class="imageblock">
<div class="content">
<img src="_images/new-github-oauth-app.png" alt="new github oauth app">
</div>
<div class="title">Figure 1. New GitHub OAuth App</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <code>Register Application</code> to create the application. Click <code>Generate a new client secret</code>. Copy the client ID and client secret and store it securely.</p>
</li>
<li>
<p>The next step is to use the generated client ID and client secret in an OpenShift Secret resource on the Dev Spaces side of the configuration to enable OAuth authentication. Create a new YAML file named <code>github-oauth-conf.yaml</code> with the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: Secret
apiVersion: v1
metadata:
  name: github-oauth-config
  namespace: openshift-devspaces
  labels:
    app.kubernetes.io/part-of: che.eclipse.org
    app.kubernetes.io/component: oauth-scm-configuration
  annotations:
    che.eclipse.org/oauth-scm-server: github
    che.eclipse.org/scm-server-endpoint: https://github.com
    che.eclipse.org/scm-github-disable-subdomain-isolation: 'false'
type: Opaque
stringData:
  id: <em>&lt;GitHub_OAuth_Client_ID&gt;</em>
  secret: <em>&lt;GitHub_OAuth_Client_Secret&gt;</em></code></pre>
</div>
</div>
</li>
<li>
<p>Create the secret using the <code>oc</code> CLI:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc apply -f github-oauth-conf.yaml
<em>secret/github-oauth-config created</em></code></pre>
</div>
</div>
</li>
<li>
<p>Wait for a few minutes while the Dev Spaces pods are restarted with the changes. With the browser in <code>Private</code> or <code>Incognito</code> mode, log in as the <code>user1</code> user and launch a new workspace by providing the GitHub URL of a <strong>private</strong> repository in the <code>Git repo URL</code> field.</p>
<div class="imageblock">
<div class="content">
<img src="_images/workspace-git-clone.png" alt="workspace git clone">
</div>
<div class="title">Figure 2. Provide the GitHub URL of a private repository</div>
</div>
<div class="paragraph">
<p>Click <code>Create &amp; Open</code> to launch the workspace.</p>
</div>
</li>
<li>
<p>Dev Spaces will prompt you for your GitHub credentials and show details about the OAuth app you created previously. Click <code>Authorize</code> to continue.</p>
<div class="imageblock">
<div class="content">
<img src="_images/github-oauth-prompt.png" alt="GitHub OAuth Login">
</div>
</div>
</li>
<li>
<p>After your workspace loads, open a new VSCode terminal. Run the <code>git config -l</code> command and notice that your username and email have been injected automatically into your git client configuration.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ git config -l
filter.lfs.clean=git-lfs clean -- %f
filter.lfs.smudge=git-lfs smudge -- %f
...
<strong>user.name=&lt;Your Name&gt;
user.email=&lt;Your EMail&gt;</strong>
...</code></pre>
</div>
</div>
</li>
<li>
<p>Make some changes to the code in the repository, stage the files, and commit them with a suitable message. Run <code>git push</code> and verify that the changes are pushed back to your GitHub repository.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="auto-namespaces.html">Namespace Control</a></span>
  <span class="next"><a href="rbac.html">Access Control</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
