<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Granular Access Control in Dev Spaces :: Securing Access to Red Hat OpenShift DevSpaces</title>
    <link rel="prev" href="auth.html">
    <link rel="next" href="resources.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../..">Securing Access to Red Hat OpenShift DevSpaces</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/devspaces-security/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="devspaces-security" data-version="3">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Securing Access to Red Hat OpenShift DevSpaces</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Home</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="auto-namespaces.html">Namespace Control</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="auth.html">Authentication</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="rbac.html">Access Control</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="resources.html">Resources</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Securing Access to Red Hat OpenShift DevSpaces</span>
    <span class="version">3</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Securing Access to Red Hat OpenShift DevSpaces</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">3</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Securing Access to Red Hat OpenShift DevSpaces</a></li>
    <li><a href="rbac.html">Access Control</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Granular Access Control in Dev Spaces</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In the previous section, you learnt how to manage authentication and access to Dev Spaces. In large enterprise environments with a large number of developers from different organizations and teams trying to access Dev Spaces, you need more finer grained control over who is allowed to access Dev Spaces.</p>
</div>
<div class="paragraph">
<p>A simple approach is to create OpenShift <code>Groups</code> and add users to these groups. You can then control access to Dev Spaces at both the group level as well as individually allow or deny access to users.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This configuration is done at the <code>CheCluster</code> CR level so it is applicable to all workspaces in Dev Spaces.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_advanced_authorization_in_the_checluster_cr"><a class="anchor" href="#_enabling_advanced_authorization_in_the_checluster_cr"></a>Enabling Advanced Authorization in the CheCluster CR</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can edit the <code>CheCluster</code> CR YAML and enable advanced authorization that gives you finer grained access control to the Dev Spaces workspaces. There are four attributes available:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">allowGroups</dt>
<dd>
<p>Only users in these groups are allowed access</p>
</dd>
<dt class="hdlist1">allowUsers</dt>
<dd>
<p>Only the individual users listed in this attribute will be allowed access</p>
</dd>
<dt class="hdlist1">denyGroups</dt>
<dd>
<p>All users in the groups listed are denied access</p>
</dd>
<dt class="hdlist1">denyUsers</dt>
<dd>
<p>All users listed in this attribute are denied access</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If these attributes are missing in the <code>CheCluster</code> CR, then <strong>ALL</strong> users are allowed access to Dev Spaces.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If the same users and groups exist in the allow and deny lists, then the <strong>DENY</strong> lists take precedence and the users and groups will be denied access.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_enhanced_authorization_with_dev_spaces"><a class="anchor" href="#_lab_enhanced_authorization_with_dev_spaces"></a>Lab: Enhanced Authorization with Dev Spaces</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pre_requisites"><a class="anchor" href="#_pre_requisites"></a>Pre-requisites</h3>
<div class="paragraph">
<p>You must have created the <code>admin</code> user with <code>cluster-admin</code> privileges and five users (<code>user1..user5</code>) that can access Dev Spaces as a regular developer user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get users
NAME   ...       IDENTITIES
admin  ...      htpasswd_provider:admin
user1  ...      htpasswd_provider:user1
user2  ...      htpasswd_provider:user2
user3  ...      htpasswd_provider:user3
user4  ...      htpasswd_provider:user4
user5  ...      htpasswd_provider:user5</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_steps"><a class="anchor" href="#_steps"></a>Steps</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in as the <code>admin</code> user using the <code>oc</code> CLI</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc login -u admin <em>&lt;OpenShift API URL&gt;</em></code></pre>
</div>
</div>
</li>
<li>
<p>Create a new OpenShift group named <code>dev-team</code>. This group will contain all developers whom you wish to provide access (to Dev Spaces)</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc adm groups new dev-team
<em>group.user.openshift.io/dev-team created</em></code></pre>
</div>
</div>
</li>
<li>
<p>Add <code>user2</code> to the <code>dev-team</code> group. You can add more users to this group if you want.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc adm groups add-users dev-team user2
<em>group.user.openshift.io/dev-team added: "user2"</em></code></pre>
</div>
</div>
</li>
<li>
<p>List the users in the <code>dev-team</code> group and verify that the users you added in the previous step are visible.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get groups dev-team --output jsonpath={.users}
<em>["user2"]</em></code></pre>
</div>
</div>
</li>
<li>
<p>In the next steps, you will enable advanced authorization by editing the <code>devspaces</code> CheCluster CR. Before you do this, verify that other users not in the <code>dev-team</code> group can access the Dev Spaces dashboard and launch workspaces.</p>
</li>
<li>
<p>Edit the <code>devspaces</code> CheCluster CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc edit checluster/devspaces -n openshift-devspaces</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enable the <strong>advancedAuthorization</strong> attribute under the <strong>networking.auth</strong> section in the YAML configuration and save the changes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  components:
    cheServer:
      ...
  devEnvironments:
      ...
  gitServices: {}
  <strong>networking:
    auth:
      advancedAuthorization:
        allowGroups:
        - dev-team</strong>
      gateway:
       ...</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for a few minutes for the Dev Spaces pods to be restarted with the changes. Log out of all active sessions in Dev Spaces.</p>
</li>
<li>
<p>Log in to OpenShift as the <code>user2</code> user and then open the Dev Spaces dashboard. You will be allowed to access the dashboard because you explicitly allowed access to the <code>dev-team</code> group, and <code>user2</code> belongs to the this group. If you added other users to this group, verify that they can access the Dev Spaces dashboard.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You may have to open a new browser in private or incognito mode to test other users since your current active browser instance will store the session cookies for <code>user2</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Now, login as one of the users NOT in the the <code>dev-team</code> group. For example, when you log in as <code>user5</code>, you should be denied access, and you will see an error like the following:</p>
<div class="imageblock">
<div class="content">
<img src="_images/user-rbac-error.png" alt="user rbac error">
</div>
<div class="title">Figure 1. Access Denied for users not in the allowed group</div>
</div>
</li>
<li>
<p>Let us image a scenario where you want to control access at the individual user level without adding the user to a group. For example, let us say you want to allow <code>user5</code> access to Dev Spaces without adding the user to the <code>dev-team</code> group. Make the following changes to the <code>devspaces</code> CheCluster CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">...
networking:
    auth:
      advancedAuthorization:
        allowGroups:
        - dev-team
        <strong>allowUsers:
        - user5</strong>
      gateway:
        ...</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the pods to restart. Log out from all active Dev Spaces sessions. Log in as <code>user5</code> and verify that the account can access the Dev Spaces dashboard. Experiment with the <code>denyUsers</code> and <code>denyGroups</code> attributes and test out access with various combinations of these four attributes.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
We recommend you roll back the changes (allow full access to all users) you made in this lab before proceeding to the next sections and courses in the learning path. Based on configurations you will be doing in the upcoming sections, you may be confused by access denied and other errors due to improper configuration of role based access. It is better to start with a clean slate for future hands-on labs. You can always selectively enable RBAC after you have configured other features and functions of Dev Spaces.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="auth.html">Authentication</a></span>
  <span class="next"><a href="resources.html">Resources</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
